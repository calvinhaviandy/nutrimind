<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Reports - NutriMind</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300..800&display=swap" rel="stylesheet">

<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { display: ["Manrope", "sans-serif"] },
      colors: {
        primary: "#135bec",
        muted: "#637588",
        bg: "#f6f6f8"
      }
    }
  }
}
</script>
</head>

<body class="bg-bg font-display text-slate-900">

    <div class="flex h-screen overflow-hidden">

        <!-- ================= SIDEBAR ================= -->
        <aside id="sidebar"
        class="fixed md:relative inset-y-0 left-0 w-64 bg-white border-r z-40
                transform -translate-x-full md:translate-x-0 transition duration-300 ease-in-out shadow-lg md:shadow-none">

            <!-- Logo -->
            <div class="h-16 flex items-center px-6 border-b">
                <i data-lucide="leaf" class="text-primary mr-2"></i>
                <span class="font-extrabold text-xl">NutriMind</span>
            </div>

            <!-- Menu -->
            <nav class="p-4 space-y-2">
                <a href="dashboard"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg
                        text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
                    <i data-lucide="layout-dashboard"></i> Dashboard
                </a>

                <a href="food-log"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg
                        text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
                    <i data-lucide="utensils"></i> Food Log
                </a>

                <a href="meal-plan"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg
                        text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
                    <i data-lucide="calendar"></i> Meal Plans
                </a>

                <a href="reports"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg
                        bg-primary/10 text-primary font-semibold transition-all duration-200 hover:translate-x-1 active:scale-95">
                    <i data-lucide="bar-chart-3"></i> Reports
                </a>

                <p class="mt-6 text-xs font-bold uppercase text-muted px-3">Settings</p>

                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
                    <i data-lucide="user"></i> Profile
                </a>

                <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
                    <i data-lucide="settings"></i> Preferences
                </a>
            </nav>

            <!-- Logout -->
            <div class="absolute bottom-0 w-full border-t p-4">
                <button id="logoutBtn"
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200
                        text-muted hover:bg-red-50 hover:text-red-600 active:scale-95">
                    <i data-lucide="log-out" class="w-5"></i>
                    <span class="font-medium">Logout</span>
                </button>
            </div>
        </aside>

        <!-- ================= MAIN WRAPPER ================= -->
        <div class="flex-1 flex flex-col">

            <!-- ================= MOBILE ================= -->
            <header class="md:hidden h-16 bg-white border-b flex items-center justify-between px-4">
                <div class="flex items-center gap-2 font-bold">
                    <i data-lucide="leaf" class="text-primary"></i>
                    NutriMind
                </div>
                <button onclick="toggleSidebar()" class="transition-transform duration-150 active:scale-90">
                    <i data-lucide="menu"></i>
                </button>
            </header>

            <!-- ================= CONTENT ================= -->
            <main class="flex-1 overflow-y-auto p-4 md:p-8">

                <h1 class="text-3xl font-extrabold mb-6">Reports</h1>

                <!-- WEEKLY -->
                <div class="bg-white p-6 rounded-xl border mb-8 transition duration-200 hover:-translate-y-1 hover:shadow-lg">
                    <h3 class="font-bold mb-4">Weekly Calories</h3>
                    <canvas id="weeklyChart" height="120"></canvas>

                    <div class="grid grid-cols-3 gap-4 mt-6 text-center">
                        <div>
                            <p class="text-sm text-muted">Protein Avg</p>
                            <p id="wProtein" class="font-bold"></p>
                        </div>
                        <div>
                            <p class="text-sm text-muted">Carbs Avg</p>
                            <p id="wCarbs" class="font-bold"></p>
                        </div>
                        <div>
                            <p class="text-sm text-muted">Fat Avg</p>
                            <p id="wFat" class="font-bold"></p>
                        </div>
                    </div>
                </div>

                <!-- MONTHLY -->
                <div class="bg-white p-6 rounded-xl border transition duration-200 hover:-translate-y-1 hover:shadow-lg">
                    <h3 class="font-bold mb-4">Monthly Calories Trend</h3>
                    <canvas id="monthlyChart" height="120"></canvas>
                </div>

            </main>
        </div>
    </div>

<script>
    function toggleSidebar() {
        document.getElementById("sidebar")
            .classList.toggle("-translate-x-full");
    }

    fetch("/api/reports/weekly")
    .then(r=>r.json())
    .then(d=>{
        new Chart(document.getElementById("weeklyChart"),{
            type:"bar",
            data:{
                labels:d.daily.map(x=>x.day),
                datasets:[{
                    label:"Calories",
                    data:d.daily.map(x=>x.calories),
                    backgroundColor:"#135bec"
                }]
            }
        });

        wProtein.innerText = Math.round(d.macros.protein) + " g";
        wCarbs.innerText   = Math.round(d.macros.carbs) + " g";
        wFat.innerText     = Math.round(d.macros.fat) + " g";
    });

    fetch("/api/reports/monthly")
    .then(r=>r.json())
    .then(d=>{
        new Chart(document.getElementById("monthlyChart"),{
            type:"line",
            data:{
                labels:d.map(x=>"Week " + x.week),
                datasets:[{
                    label:"Calories",
                    data:d.map(x=>x.calories),
                    borderColor:"#135bec",
                    tension:0.3
                }]
            }
        });
    });

    // logout
    document.getElementById("logoutBtn").addEventListener("click",()=>{
        if(confirm("Are you sure you want to logout?")){
            window.location.href="/logout";
        }
    });

    lucide.createIcons();
</script>

</body>
</html>
