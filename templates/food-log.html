<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Food Log - NutriMind</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300..800&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { display: ["Manrope", "sans-serif"] },
      colors: {
        primary: "#135bec",
        muted: "#637588",
        bg: "#f6f6f8",
      },
    },
  },
};
</script>
</head>

<body class="bg-bg font-display text-slate-900">

<div class="flex h-screen overflow-hidden">

  <!-- SIDEBAR -->
  <aside id="sidebar"
    class="fixed md:relative inset-y-0 left-0 w-64 bg-white border-r z-40
    transform -translate-x-full md:translate-x-0 transition duration-300 ease-in-out shadow-lg md:shadow-none">

    <div class="h-16 flex items-center px-6 border-b">
      <i data-lucide="leaf" class="text-primary mr-2"></i>
      <span class="font-extrabold text-xl">NutriMind</span>
    </div>

    <nav class="p-4 space-y-2">
      <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95" href="dashboard">
        <i data-lucide="layout-dashboard"></i> Dashboard
      </a>
      <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/10 text-primary font-semibold transition-all duration-200 hover:translate-x-1 active:scale-95" href="food-log">
        <i data-lucide="utensils"></i> Food Log
      </a>
      <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95" href="meal-plan">
        <i data-lucide="calendar"></i> Meal Plans
      </a>
      <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95" href="reports">
        <i data-lucide="bar-chart-3"></i> Reports
      </a>

      <p class="mt-6 text-xs font-bold uppercase text-muted px-3">Settings</p>

      <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
        <i data-lucide="user"></i> Profile
      </a>
      <a class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-muted hover:bg-slate-100 transition-all duration-200 hover:translate-x-1 active:scale-95">
        <i data-lucide="settings"></i> Preferences
      </a>
    </nav>
    <div class="absolute bottom-0 w-full border-t p-4">
        <button id="logoutBtn"
            class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200
                  text-muted hover:bg-red-50 hover:text-red-600 active:scale-95">
            <i data-lucide="log-out" class="w-5"></i>
            <span class="font-medium">Logout</span>
        </button>
    </div>
  </aside>

<!-- MAIN -->
<div class="flex-1 flex flex-col">

    <header class="md:hidden h-16 bg-white border-b flex items-center justify-between px-4">
      <span class="font-bold flex items-center gap-2">
        <i data-lucide="leaf" class="text-primary"></i> NutriMind
      </span>
      <button onclick="toggleSidebar()" class="transition-transform duration-150 active:scale-90"><i data-lucide="menu"></i></button>
    </header>

    <main class="flex-1 overflow-y-auto p-4 md:p-8">

      <h1 class="text-3xl font-black mb-4">Food Log</h1>

      <!-- FILTER DATE -->
      <form method="GET" class="mb-6 flex gap-3 items-end">
        <div>
          <label class="text-xs font-bold text-muted">Date</label>
          <input
            type="date"
            name="date"
            value="{{ request.args.get('date','') }}"
            class="border rounded-lg px-3 py-2 text-sm"
          >
        </div>

        <button class="h-10 px-5 rounded-lg bg-primary text-white font-bold transition-transform duration-150 active:scale-95">
          Filter
        </button>
      </form>

      <!-- DESKTOP TABLE -->
      <div class="hidden md:block bg-white border rounded-xl overflow-x-auto transition duration-200 hover:-translate-y-1 hover:shadow-lg">
        <table class="min-w-full text-sm text-center">
          <thead class="bg-slate-50 text-muted">
            <tr class="transition duration-150 hover:bg-slate-50">
              <th class="p-3">Image</th>
              <th class="p-3">Food</th>
              <th class="p-3">Caloric Value</th>
              <th class="p-3">Fat</th>
              <th class="p-3">Protein</th>
              <th class="p-3">Nutrition Density</th>
              <th class="p-3">Action</th>
            </tr>
          </thead>

          <tbody class="divide-y">

            {% for f in logs %}
            <tr class="transition duration-150 hover:bg-slate-50">
              <td class="p-3">
                <div class="flex justify-center">
                  <img src="{{ url_for('static', filename=f.image_path) }}"
                      class="w-10 h-10 rounded-md object-cover">
                </div>
              </td>

              <td class="p-3 font-bold">{{ f.food_name }}</td>
              <td class="p-3 font-semibold">{{ f.caloric_value }} kcal</td>
              <td class="p-3">{{ f.fat }} g</td>
              <td class="p-3">{{ f.protein }} g</td>
              <td class="p-3 font-semibold text-emerald-600">
                {{ f.nutrition_density }}
              </td>

              <td class="p-3">
                <button
                  onclick="openModal(this)"
                  class="px-4 py-2 bg-primary text-white text-xs font-bold rounded-lg transition-transform duration-150 active:scale-95"

                  data-name="{{ f.food_name }}"
                  data-image="{{ url_for('static', filename=f.image_path) }}"
                  data-calorie="{{ f.caloric_value }}"
                  data-fat="{{ f.fat }}"
                  data-satfat="{{ f.saturated_fats }}"
                  data-mono="{{ f.monounsaturated_fats }}"
                  data-poly="{{ f.polyunsaturated_fats }}"
                  data-carb="{{ f.carbohydrates }}"
                  data-sugar="{{ f.sugars }}"
                  data-protein="{{ f.protein }}"
                  data-fiber="{{ f.dietary_fiber }}"
                  data-chol="{{ f.cholesterol }}"
                  data-sodium="{{ f.sodium }}"
                  data-water="{{ f.water }}"
                  data-vitc="{{ f.vitamin_c }}"
                  data-density="{{ f.nutrition_density }}"
                  data-vita="{{ f.vitamin_a }}"
                  data-vitb1="{{ f.vitamin_b1 }}"
                  data-vitb11="{{ f.vitamin_b11 }}"
                  data-vitb12="{{ f.vitamin_b12 }}"
                  data-vitb2="{{ f.vitamin_b2 }}"
                  data-vitb3="{{ f.vitamin_b3 }}"
                  data-vitb5="{{ f.vitamin_b5 }}"
                  data-vitb6="{{ f.vitamin_b6 }}"
                  data-vitd="{{ f.vitamin_d }}"
                  data-vite="{{ f.vitamin_e }}"
                  data-vitk="{{ f.vitamin_k }}"

                  data-calcium="{{ f.calcium }}"
                  data-copper="{{ f.copper }}"
                  data-iron="{{ f.iron }}"
                  data-magnesium="{{ f.magnesium }}"
                  data-manganese="{{ f.manganese }}"
                  data-phosphorus="{{ f.phosphorus }}"
                  data-potassium="{{ f.potassium }}"
                  data-selenium="{{ f.selenium }}"
                  data-zinc="{{ f.zinc }}"
                >
                  View Details</button>
              </td>
            </tr>
            {% else %}
            <tr class="transition duration-150 hover:bg-slate-50">
              <td colspan="7" class="p-6 text-muted font-semibold">
                No food log found
              </td>
            </tr>
            {% endfor %}

          </tbody>

        </table>
      </div>

      <!-- MOBILE -->
      <div class="md:hidden space-y-4">

        {% for f in logs %}
        <div class="bg-white border rounded-xl p-4 flex gap-4 transition duration-200 hover:-translate-y-1 hover:shadow-md">
          <img src="{{ url_for('static', filename=f.image_path) }}"
              class="rounded-lg w-20 h-20 object-cover">

          <div class="flex-1">
            <h3 class="font-black">{{ f.food_name }}</h3>
            <p class="text-sm text-muted">
              Caloric Value: {{ f.caloric_value }} kcal
            </p>

            <div class="flex flex-wrap gap-2 mt-2 text-xs font-semibold">
              <span class="px-2 py-1 rounded bg-blue-100 text-blue-700">
                Fat: {{ f.fat }} g
              </span>
              <span class="px-2 py-1 rounded bg-emerald-100 text-emerald-700">
                Protein: {{ f.protein }} g
              </span>
            </div>

            <button
            onclick="openModal(this)"
            class="mt-3 text-primary text-sm font-bold transition-transform duration-150 active:scale-95"

            data-name="{{ f.food_name }}"
            data-image="{{ url_for('static', filename=f.image_path) }}"
            data-calorie="{{ f.caloric_value }}"
            data-fat="{{ f.fat }}"
            data-satfat="{{ f.saturated_fats }}"
            data-mono="{{ f.monounsaturated_fats }}"
            data-poly="{{ f.polyunsaturated_fats }}"
            data-carb="{{ f.carbohydrates }}"
            data-sugar="{{ f.sugars }}"
            data-protein="{{ f.protein }}"
            data-fiber="{{ f.dietary_fiber }}"
            data-chol="{{ f.cholesterol }}"
            data-sodium="{{ f.sodium }}"
            data-water="{{ f.water }}"
            data-vitc="{{ f.vitamin_c }}"
            data-density="{{ f.nutrition_density }}"
            data-vita="{{ f.vitamin_a }}"
            data-vitb1="{{ f.vitamin_b1 }}"
            data-vitb11="{{ f.vitamin_b11 }}"
            data-vitb12="{{ f.vitamin_b12 }}"
            data-vitb2="{{ f.vitamin_b2 }}"
            data-vitb3="{{ f.vitamin_b3 }}"
            data-vitb5="{{ f.vitamin_b5 }}"
            data-vitb6="{{ f.vitamin_b6 }}"
            data-vitd="{{ f.vitamin_d }}"
            data-vite="{{ f.vitamin_e }}"
            data-vitk="{{ f.vitamin_k }}"

            data-calcium="{{ f.calcium }}"
            data-copper="{{ f.copper }}"
            data-iron="{{ f.iron }}"
            data-magnesium="{{ f.magnesium }}"
            data-manganese="{{ f.manganese }}"
            data-phosphorus="{{ f.phosphorus }}"
            data-potassium="{{ f.potassium }}"
            data-selenium="{{ f.selenium }}"
            data-zinc="{{ f.zinc }}"
          >
            View Details</button>
          </div>
        </div>
        {% endfor %}

      </div>

    </main>
  </div>
</div>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/40 hidden opacity-0 transition-opacity duration-200 items-center justify-center z-50">
  <div class="modal-panel bg-white rounded-xl max-w-3xl w-full p-6 overflow-y-auto max-h-[85vh] transition-transform duration-200 transform scale-95">

    <div class="flex justify-between items-center mb-4">
      <h3 id="modalTitle" class="text-xl font-black"></h3>
      <button onclick="closeModal()"><i data-lucide="x"></i></button>
    </div>

    <!-- IMAGE -->
    <div class="flex justify-center mb-6">
      <img id="modalImage"
           class="w-40 h-40 rounded-xl object-cover border">
    </div>

    <!-- NUTRITION GRID -->
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm text-center">

      <p><b>Caloric Value</b><br><span id="mCal"></span> kcal</p>
      <p><b>Fat</b><br><span id="mFat"></span> g</p>
      <p><b>Saturated Fat</b><br><span id="mSatFat"></span> g</p>

      <p><b>Mono Fat</b><br><span id="mMono"></span> g</p>
      <p><b>Poly Fat</b><br><span id="mPoly"></span> g</p>
      <p><b>Carbohydrates</b><br><span id="mCarb"></span> g</p>

      <p><b>Sugars</b><br><span id="mSugar"></span> g</p>
      <p><b>Protein</b><br><span id="mProtein"></span> g</p>
      <p><b>Dietary Fiber</b><br><span id="mFiber"></span> g</p>

      <p><b>Cholesterol</b><br><span id="mChol"></span> mg</p>
      <p><b>Sodium</b><br><span id="mSodium"></span> mg</p>
      <p><b>Water</b><br><span id="mWater"></span> g</p>

      <p><b>Vitamin C</b><br><span id="mVitC"></span> mg</p>
      <p><b>Vitamin A</b><br><span id="mVitA"></span></p>
      <p><b>Vitamin B1</b><br><span id="mVitB1"></span></p>
      <p><b>Vitamin B11</b><br><span id="mVitB11"></span></p>

      <p><b>Vitamin B12</b><br><span id="mVitB12"></span></p>
      <p><b>Vitamin B2</b><br><span id="mVitB2"></span></p>
      <p><b>Vitamin B3</b><br><span id="mVitB3"></span></p>

      <p><b>Vitamin B5</b><br><span id="mVitB5"></span></p>
      <p><b>Vitamin B6</b><br><span id="mVitB6"></span></p>
      <p><b>Vitamin D</b><br><span id="mVitD"></span></p>

      <p><b>Vitamin E</b><br><span id="mVitE"></span></p>
      <p><b>Vitamin K</b><br><span id="mVitK"></span></p>

      <!-- MINERALS -->
      <p><b>Calcium</b><br><span id="mCalcium"></span></p>
      <p><b>Copper</b><br><span id="mCopper"></span></p>
      <p><b>Iron</b><br><span id="mIron"></span></p>

      <p><b>Magnesium</b><br><span id="mMagnesium"></span></p>
      <p><b>Manganese</b><br><span id="mManganese"></span></p>
      <p><b>Phosphorus</b><br><span id="mPhosphorus"></span></p>

      <p><b>Potassium</b><br><span id="mPotassium"></span></p>
      <p><b>Selenium</b><br><span id="mSelenium"></span></p>
      <p><b>Zinc</b><br><span id="mZinc"></span></p>


      <p class="col-span-2 md:col-span-3 font-bold text-emerald-600">
        Nutrition Density: <span id="mDensity"></span>
      </p>

    </div>
  </div>
</div>

<script>
  const modal = document.getElementById("modal")
  const modalPanel = modal.querySelector(".modal-panel")

  function toggleSidebar(){
    document.getElementById("sidebar").classList.toggle("-translate-x-full")
  }

  function openModal(el){
    const set = (id, val) =>
      document.getElementById(id).innerText = val || "-"

    document.getElementById("modalTitle").innerText =
      "Nutrition Details â€“ " + el.dataset.name

    document.getElementById("modalImage").src = el.dataset.image

    set("mCal", el.dataset.calorie)
    set("mFat", el.dataset.fat)
    set("mSatFat", el.dataset.satfat)
    set("mMono", el.dataset.mono)
    set("mPoly", el.dataset.poly)
    set("mCarb", el.dataset.carb)
    set("mSugar", el.dataset.sugar)
    set("mProtein", el.dataset.protein)
    set("mFiber", el.dataset.fiber)
    set("mChol", el.dataset.chol)
    set("mSodium", el.dataset.sodium)
    set("mWater", el.dataset.water)

    // VITAMINS
    set("mVitA", el.dataset.vita)
    set("mVitB1", el.dataset.vitb1)
    set("mVitB11", el.dataset.vitb11)
    set("mVitB12", el.dataset.vitb12)
    set("mVitB2", el.dataset.vitb2)
    set("mVitB3", el.dataset.vitb3)
    set("mVitB5", el.dataset.vitb5)
    set("mVitB6", el.dataset.vitb6)
    set("mVitC", el.dataset.vitc)
    set("mVitD", el.dataset.vitd)
    set("mVitE", el.dataset.vite)
    set("mVitK", el.dataset.vitk)

    // MINERALS
    set("mCalcium", el.dataset.calcium)
    set("mCopper", el.dataset.copper)
    set("mIron", el.dataset.iron)
    set("mMagnesium", el.dataset.magnesium)
    set("mManganese", el.dataset.manganese)
    set("mPhosphorus", el.dataset.phosphorus)
    set("mPotassium", el.dataset.potassium)
    set("mSelenium", el.dataset.selenium)
    set("mZinc", el.dataset.zinc)

    set("mDensity", el.dataset.density)

    modal.classList.remove("hidden")
    modal.classList.add("flex")
    requestAnimationFrame(() => {
      modal.classList.remove("opacity-0")
      modalPanel.classList.remove("scale-95")
      modalPanel.classList.add("scale-100")
    })
  }

  function closeModal(){
    modal.classList.add("opacity-0")
    modalPanel.classList.add("scale-95")
    modalPanel.classList.remove("scale-100")
    setTimeout(() => {
      modal.classList.add("hidden")
      modal.classList.remove("flex")
    }, 200)
  }

  // logout
  document.getElementById("logoutBtn").addEventListener("click", () => {
    if (confirm("Are you sure you want to logout?")) {
      window.location.href = "/logout";
    }
  });

  lucide.createIcons()
</script>

</body>
</html>

